<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>但願人長久 - Lyrics Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --paper-white: #fafafa;
            --stone-white: #f5f5f5;
            --text-carved: #c0c0c0;
            --text-primary: #e8e8e8;
            --shadow-raised: -6px -6px 12px rgba(255, 255, 255, 0.8), 
                             6px 6px 12px rgba(0, 0, 0, 0.1);
            --shadow-sunken: inset 4px 4px 8px rgba(0, 0, 0, 0.1),
                            inset -4px -4px 8px rgba(255, 255, 255, 0.7);
            --shadow-paper: 0 2px 8px rgba(0, 0, 0, 0.03);
        }

        body {
            font-family: 'Noto Serif', 'Times New Roman', serif;
            background: var(--paper-white);
            color: var(--text-primary);
            line-height: 1.8;
            padding: 3rem 1rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 4rem;
            padding: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            color: #d0d0d0;
            letter-spacing: 0.1em;
        }

        .subtitle {
            font-size: 1rem;
            color: #c8c8c8;
            margin-bottom: 0.5rem;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        .metadata {
            font-size: 0.85rem;
            color: #d0d0d0;
            margin-top: 1rem;
            font-weight: 300;
            letter-spacing: 0.03em;
        }

        .controls {
            text-align: center;
            padding: 1.5rem;
            margin-bottom: 3rem;
            font-size: 0.8rem;
            color: #c0c0c0;
            letter-spacing: 0.05em;
            font-weight: 300;
        }

        .controls kbd {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            background: var(--paper-white);
            box-shadow: var(--shadow-sunken);
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            font-size: 0.75rem;
            margin: 0 0.25rem;
            color: #b8b8b8;
        }

        .lyrics-container {
            display: flex;
            flex-direction: column;
            gap: 4rem;
        }

        .line-row {
            padding: 2rem 1rem;
            transition: all 0.3s ease;
        }

        .original-line {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            color: #d8d8d8;
            text-align: center;
            letter-spacing: 0.2em;
            font-weight: 300;
            opacity: 0.4;
            transition: opacity 0.3s ease;
        }

        .line-row.has-focus .original-line {
            opacity: 0.8;
        }

        .character-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        /* Mahjong tile styling */
        .character-card {
            background: var(--stone-white);
            border-radius: 8px;
            padding: 1.5rem 1rem;
            min-width: 90px;
            width: 90px;
            height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            
            /* Default: sunken (pressed in) */
            box-shadow: var(--shadow-sunken);
        }

        .character-card:hover:not(.focused) {
            opacity: 0.8;
        }

        /* Raised tile - only for focused character */
        .character-card.focused {
            box-shadow: var(--shadow-raised);
            transform: translateY(-2px);
        }

        .chinese-char {
            font-size: 2.2rem;
            font-weight: 400;
            color: #d0d0d0;
            line-height: 1;
            letter-spacing: 0.02em;
        }

        .character-card.focused .chinese-char {
            color: #a8a8a8;
        }

        .literal-meaning {
            font-size: 0.7rem;
            color: var(--text-carved);
            text-align: center;
            font-weight: 400;
            text-transform: lowercase;
            letter-spacing: 0.03em;
            opacity: 0.7;
            font-family: 'Courier New', monospace;
        }

        .character-card.focused .literal-meaning {
            opacity: 1;
            color: #a0a0a0;
        }

        .notes {
            font-size: 0.6rem;
            color: var(--text-carved);
            font-style: italic;
            margin-top: 0.25rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            position: absolute;
            bottom: 0.5rem;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .character-card.focused .notes {
            opacity: 0.6;
        }

        .translations {
            padding-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        .line-row.has-focus .translations {
            opacity: 0.6;
        }

        .translation {
            padding: 1rem;
            text-align: center;
        }

        .translation-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #c0c0c0;
            font-weight: 300;
            margin-bottom: 0.5rem;
        }

        .translation-text {
            font-size: 0.9rem;
            color: #d0d0d0;
            line-height: 1.8;
            font-weight: 300;
            letter-spacing: 0.02em;
        }

        .progress {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-size: 0.75rem;
            color: #c0c0c0;
            z-index: 1000;
            background: var(--paper-white);
            box-shadow: var(--shadow-sunken);
            letter-spacing: 0.05em;
            font-weight: 300;
        }

        .progress-number {
            font-weight: 400;
            color: #b0b0b0;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .character-cards {
                gap: 1rem;
            }

            .character-card {
                min-width: 75px;
                width: 75px;
                height: 120px;
                padding: 1.25rem 0.75rem;
            }

            .chinese-char {
                font-size: 1.8rem;
            }

            .line-row {
                padding: 1.5rem 0.5rem;
            }
        }

        @keyframes subtleFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-1px);
            }
        }

        .character-card.focused {
            animation: subtleFloat 3s ease-in-out infinite;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>但願人長久</h1>
            <div class="subtitle">Wishing Us Long Life</div>
            <div class="metadata">
                菲靡靡之音 • 1995<br>
                水調歌頭 • 蘇軾 • Song Dynasty, 1076
            </div>
        </header>

        <div class="controls">
            <kbd>←</kbd> <kbd>→</kbd> characters • 
            <kbd>↑</kbd> <kbd>↓</kbd> lines • 
            <kbd>Home</kbd> line start • <kbd>End</kbd> line end • 
            <kbd>Ctrl</kbd>+<kbd>Home</kbd> first • <kbd>Ctrl</kbd>+<kbd>End</kbd> last • 
            <kbd>Tab</kbd> next line • <kbd>Shift</kbd>+<kbd>Tab</kbd> prev line • 
            <kbd>PgUp</kbd> <kbd>PgDn</kbd> jump
        </div>

        <div class="progress">
            Character <span class="progress-number" id="current-char">1</span> • 
            Line <span class="progress-number" id="current-line">1</span>/<span class="progress-number" id="total-lines">10</span>
        </div>

        <div class="lyrics-container" id="lyrics-container">
            <!-- Lyrics will be dynamically loaded here -->
        </div>
    </div>

    <script>
        let currentLineIndex = 0;
        
        // Embedded lyrics data
        const lyricsData = {
            "metadata": {
                "title": "但願人長久",
                "title_translation": "Wishing Us Long Life",
                "artist": "菲靡靡之音",
                "artist_romanization": "Fei Mi Mi Zhi Yin",
                "year": 1995,
                "original_poem": "水調歌頭",
                "original_poem_translation": "Shui Diao Ge Tou (Prelude to Water Melody)",
                "poet": "蘇軾",
                "poet_translation": "Su Shi",
                "dynasty": "宋朝",
                "dynasty_translation": "Song Dynasty",
                "poem_year": 1076
            },
            "lyrics": [
                {
                    "line": "明月幾時有，把酒問青天。",
                    "words": [
                        {"chinese": "明月", "literal": "bright moon", "notes": "full/bright moon"},
                        {"chinese": "幾時", "literal": "what time", "notes": "when"},
                        {"chinese": "有", "literal": "have/exist"},
                        {"chinese": "把", "literal": "hold", "notes": "measure word for holding"},
                        {"chinese": "酒", "literal": "wine/liquor"},
                        {"chinese": "問", "literal": "ask"},
                        {"chinese": "青天", "literal": "blue sky", "notes": "the heavens"}
                    ],
                    "literal_translation": "Bright moon when time exist, hold wine ask blue sky.",
                    "natural_translation": "When did the bright moon first appear? I lift my wine cup and ask the blue sky."
                },
                {
                    "line": "不知天上宮闕，今夕是何年。",
                    "words": [
                        {"chinese": "不", "literal": "not"},
                        {"chinese": "知", "literal": "know"},
                        {"chinese": "天上", "literal": "sky above/heaven"},
                        {"chinese": "宮闕", "literal": "palace halls", "notes": "imperial palaces"},
                        {"chinese": "今夕", "literal": "this evening"},
                        {"chinese": "是", "literal": "is/be"},
                        {"chinese": "何", "literal": "what/which"},
                        {"chinese": "年", "literal": "year"}
                    ],
                    "literal_translation": "Not know heaven above palace halls, this evening is what year.",
                    "natural_translation": "I wonder what year it is tonight in those celestial palaces above."
                },
                {
                    "line": "我欲乘風歸去，唯恐瓊樓玉宇，",
                    "words": [
                        {"chinese": "我", "literal": "I/me"},
                        {"chinese": "欲", "literal": "desire/want"},
                        {"chinese": "乘", "literal": "ride/mount"},
                        {"chinese": "風", "literal": "wind"},
                        {"chinese": "歸去", "literal": "return go", "notes": "return home"},
                        {"chinese": "唯", "literal": "only"},
                        {"chinese": "恐", "literal": "fear/worry"},
                        {"chinese": "瓊樓", "literal": "jade tower", "notes": "magnificent buildings"},
                        {"chinese": "玉宇", "literal": "jade universe", "notes": "celestial palaces"}
                    ],
                    "literal_translation": "I desire ride wind return go, only fear jade tower jade universe,",
                    "natural_translation": "I wish to ride the wind and return there, yet I fear those jade towers and crystal palaces,"
                },
                {
                    "line": "高處不勝寒。起舞弄清影，",
                    "words": [
                        {"chinese": "高處", "literal": "high place"},
                        {"chinese": "不勝", "literal": "cannot withstand", "notes": "unbearable"},
                        {"chinese": "寒", "literal": "cold"},
                        {"chinese": "起", "literal": "rise/stand up"},
                        {"chinese": "舞", "literal": "dance"},
                        {"chinese": "弄", "literal": "play with"},
                        {"chinese": "清影", "literal": "clear shadow", "notes": "moonlit shadow"}
                    ],
                    "literal_translation": "High place cannot withstand cold. Rise dance play clear shadow,",
                    "natural_translation": "The heights are unbearably cold. I rise and dance, playing with my clear shadow,"
                },
                {
                    "line": "何似在人間。",
                    "words": [
                        {"chinese": "何", "literal": "what/how"},
                        {"chinese": "似", "literal": "resemble/like", "notes": "compare to"},
                        {"chinese": "在", "literal": "at/in"},
                        {"chinese": "人間", "literal": "human world", "notes": "mortal realm"}
                    ],
                    "literal_translation": "How compare to at human world.",
                    "natural_translation": "How can it compare to being in the mortal world?"
                },
                {
                    "line": "轉朱閣，低綺戶，照無眠。",
                    "words": [
                        {"chinese": "轉", "literal": "turn/revolve"},
                        {"chinese": "朱閣", "literal": "vermillion pavilion", "notes": "red-painted tower"},
                        {"chinese": "低", "literal": "low/descend"},
                        {"chinese": "綺戶", "literal": "silk door", "notes": "ornate window"},
                        {"chinese": "照", "literal": "shine upon/illuminate"},
                        {"chinese": "無", "literal": "no/without"},
                        {"chinese": "眠", "literal": "sleep"}
                    ],
                    "literal_translation": "Turn vermillion pavilion, low silk door, shine without sleep.",
                    "natural_translation": "The moon circles the red tower, descends past the ornate windows, shining on the sleepless."
                },
                {
                    "line": "不應有恨，何事長向別時圓。",
                    "words": [
                        {"chinese": "不應", "literal": "should not"},
                        {"chinese": "有", "literal": "have"},
                        {"chinese": "恨", "literal": "hate/regret", "notes": "resentment"},
                        {"chinese": "何", "literal": "what"},
                        {"chinese": "事", "literal": "matter/thing"},
                        {"chinese": "長", "literal": "always/often"},
                        {"chinese": "向", "literal": "toward/facing"},
                        {"chinese": "別時", "literal": "parting time", "notes": "time of separation"},
                        {"chinese": "圓", "literal": "round/full", "notes": "full moon"}
                    ],
                    "literal_translation": "Should not have regret, what matter always toward parting time round.",
                    "natural_translation": "The moon should hold no grudge—why is it always full when people are apart?"
                },
                {
                    "line": "人有悲歡離合，月有陰晴圓缺，",
                    "words": [
                        {"chinese": "人", "literal": "people/humans"},
                        {"chinese": "有", "literal": "have"},
                        {"chinese": "悲", "literal": "sorrow"},
                        {"chinese": "歡", "literal": "joy"},
                        {"chinese": "離", "literal": "separation"},
                        {"chinese": "合", "literal": "reunion/union"},
                        {"chinese": "月", "literal": "moon"},
                        {"chinese": "有", "literal": "have"},
                        {"chinese": "陰", "literal": "dark/cloudy"},
                        {"chinese": "晴", "literal": "clear/sunny"},
                        {"chinese": "圓", "literal": "round/full"},
                        {"chinese": "缺", "literal": "lacking/waning"}
                    ],
                    "literal_translation": "People have sorrow joy separation union, moon have dark clear round lacking,",
                    "natural_translation": "People experience sorrow and joy, separation and reunion; the moon has dark phases and bright, waxing and waning—"
                },
                {
                    "line": "此事古難全。",
                    "words": [
                        {"chinese": "此", "literal": "this"},
                        {"chinese": "事", "literal": "matter/thing"},
                        {"chinese": "古", "literal": "ancient/since old times"},
                        {"chinese": "難", "literal": "difficult"},
                        {"chinese": "全", "literal": "complete/perfect"}
                    ],
                    "literal_translation": "This matter ancient difficult complete.",
                    "natural_translation": "Such matters have never been perfect since ancient times."
                },
                {
                    "line": "但願人長久，千里共嬋娟。",
                    "words": [
                        {"chinese": "但", "literal": "only/merely"},
                        {"chinese": "願", "literal": "wish/hope"},
                        {"chinese": "人", "literal": "people/person"},
                        {"chinese": "長久", "literal": "long time/lasting"},
                        {"chinese": "千里", "literal": "thousand miles", "notes": "far apart"},
                        {"chinese": "共", "literal": "together/share"},
                        {"chinese": "嬋娟", "literal": "beautiful lady", "notes": "poetic name for the moon"}
                    ],
                    "literal_translation": "Only wish people long lasting, thousand miles together beautiful moon.",
                    "natural_translation": "I only wish that we may live long lives, and though a thousand miles apart, share the beauty of this moon together."
                }
            ]
        };

        // Navigation state
        let currentLineIndex = 0;
        let currentCharIndex = 0;

        // Initialize the viewer
        function loadLyrics() {
            renderLyrics();
            updateFocus();
        }

        function renderLyrics() {
            const container = document.getElementById('lyrics-container');
            document.getElementById('total-lines').textContent = lyricsData.lyrics.length;

            lyricsData.lyrics.forEach((line, lineIndex) => {
                const lineRow = document.createElement('div');
                lineRow.className = 'line-row';
                lineRow.dataset.lineIndex = lineIndex;

                // Original line
                const originalLine = document.createElement('div');
                originalLine.className = 'original-line';
                originalLine.textContent = line.line;
                lineRow.appendChild(originalLine);

                // Character cards
                const cardsContainer = document.createElement('div');
                cardsContainer.className = 'character-cards';

                line.words.forEach((word, charIndex) => {
                    const card = document.createElement('div');
                    card.className = 'character-card';
                    card.dataset.lineIndex = lineIndex;
                    card.dataset.charIndex = charIndex;

                    // Add click handler
                    card.addEventListener('click', () => {
                        currentLineIndex = lineIndex;
                        currentCharIndex = charIndex;
                        updateFocus();
                    });

                    const chinese = document.createElement('div');
                    chinese.className = 'chinese-char';
                    chinese.textContent = word.chinese;
                    card.appendChild(chinese);

                    const literal = document.createElement('div');
                    literal.className = 'literal-meaning';
                    literal.textContent = word.literal;
                    card.appendChild(literal);

                    if (word.notes) {
                        const notes = document.createElement('div');
                        notes.className = 'notes';
                        notes.textContent = word.notes;
                        card.appendChild(notes);
                    }

                    cardsContainer.appendChild(card);
                });

                lineRow.appendChild(cardsContainer);

                // Translations
                const translations = document.createElement('div');
                translations.className = 'translations';

                const literalTrans = document.createElement('div');
                literalTrans.className = 'translation';
                literalTrans.innerHTML = `
                    <div class="translation-label">Literal Translation</div>
                    <div class="translation-text">${line.literal_translation}</div>
                `;
                translations.appendChild(literalTrans);

                const naturalTrans = document.createElement('div');
                naturalTrans.className = 'translation';
                naturalTrans.innerHTML = `
                    <div class="translation-label">Natural Translation</div>
                    <div class="translation-text">${line.natural_translation}</div>
                `;
                translations.appendChild(naturalTrans);

                lineRow.appendChild(translations);
                container.appendChild(lineRow);
            });
        }

        function updateFocus() {
            // Remove all focused states
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('focused');
            });
            document.querySelectorAll('.line-row').forEach(row => {
                row.classList.remove('has-focus');
            });

            // Add focused state to current character
            const focusedCard = document.querySelector(
                `.character-card[data-line-index="${currentLineIndex}"][data-char-index="${currentCharIndex}"]`
            );
            
            if (focusedCard) {
                focusedCard.classList.add('focused');
                
                // Mark the line as having focus
                const lineRow = focusedCard.closest('.line-row');
                if (lineRow) {
                    lineRow.classList.add('has-focus');
                }
                
                // Smooth scroll to the focused card
                focusedCard.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'center'
                });
            }

            // Update progress indicators
            document.getElementById('current-line').textContent = currentLineIndex + 1;
            document.getElementById('current-char').textContent = currentCharIndex + 1;
        }

        function getCharCountInLine(lineIndex) {
            return lyricsData.lyrics[lineIndex].words.length;
        }

        function navigateRight() {
            const charsInCurrentLine = getCharCountInLine(currentLineIndex);
            
            if (currentCharIndex < charsInCurrentLine - 1) {
                // Move to next character in current line
                currentCharIndex++;
            } else if (currentLineIndex < lyricsData.lyrics.length - 1) {
                // Wrap to first character of next line
                currentLineIndex++;
                currentCharIndex = 0;
            }
            // If at last character of last line, stay there
            
            updateFocus();
        }

        function navigateLeft() {
            if (currentCharIndex > 0) {
                // Move to previous character in current line
                currentCharIndex--;
            } else if (currentLineIndex > 0) {
                // Wrap to last character of previous line
                currentLineIndex--;
                currentCharIndex = getCharCountInLine(currentLineIndex) - 1;
            }
            // If at first character of first line, stay there
            
            updateFocus();
        }

        function navigateDown() {
            if (currentLineIndex < lyricsData.lyrics.length - 1) {
                currentLineIndex++;
                
                // Try to maintain character position, but clamp to line length
                const charsInNewLine = getCharCountInLine(currentLineIndex);
                if (currentCharIndex >= charsInNewLine) {
                    currentCharIndex = charsInNewLine - 1;
                }
                
                updateFocus();
            }
        }

        function navigateUp() {
            if (currentLineIndex > 0) {
                currentLineIndex--;
                
                // Try to maintain character position, but clamp to line length
                const charsInNewLine = getCharCountInLine(currentLineIndex);
                if (currentCharIndex >= charsInNewLine) {
                    currentCharIndex = charsInNewLine - 1;
                }
                
                updateFocus();
            }
        }

        function navigateToFirstCharacter() {
            currentLineIndex = 0;
            currentCharIndex = 0;
            updateFocus();
        }

        function navigateToLastCharacter() {
            currentLineIndex = lyricsData.lyrics.length - 1;
            currentCharIndex = getCharCountInLine(currentLineIndex) - 1;
            updateFocus();
        }

        function navigateToNextLine() {
            if (currentLineIndex < lyricsData.lyrics.length - 1) {
                currentLineIndex++;
                currentCharIndex = 0; // Start at beginning of new line
                updateFocus();
            }
        }

        function navigateToPreviousLine() {
            if (currentLineIndex > 0) {
                currentLineIndex--;
                currentCharIndex = 0; // Start at beginning of new line
                updateFocus();
            }
        }

        function navigateToLineStart() {
            currentCharIndex = 0;
            updateFocus();
        }

        function navigateToLineEnd() {
            currentCharIndex = getCharCountInLine(currentLineIndex) - 1;
            updateFocus();
        }

        // Keyboard event listener
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    navigateLeft();
                    break;
                    
                case 'ArrowRight':
                    e.preventDefault();
                    navigateRight();
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    navigateUp();
                    break;
                    
                case 'ArrowDown':
                    e.preventDefault();
                    navigateDown();
                    break;
                    
                case 'Home':
                    e.preventDefault();
                    if (e.ctrlKey || e.metaKey) {
                        // Ctrl/Cmd + Home: Go to very first character
                        navigateToFirstCharacter();
                    } else {
                        // Home: Go to start of current line
                        navigateToLineStart();
                    }
                    break;
                    
                case 'End':
                    e.preventDefault();
                    if (e.ctrlKey || e.metaKey) {
                        // Ctrl/Cmd + End: Go to very last character
                        navigateToLastCharacter();
                    } else {
                        // End: Go to end of current line
                        navigateToLineEnd();
                    }
                    break;
                    
                case 'Tab':
                    e.preventDefault();
                    if (e.shiftKey) {
                        navigateToPreviousLine();
                    } else {
                        navigateToNextLine();
                    }
                    break;
                    
                case 'PageDown':
                    e.preventDefault();
                    // Jump 3 lines down
                    for (let i = 0; i < 3 && currentLineIndex < lyricsData.lyrics.length - 1; i++) {
                        navigateDown();
                    }
                    break;
                    
                case 'PageUp':
                    e.preventDefault();
                    // Jump 3 lines up
                    for (let i = 0; i < 3 && currentLineIndex > 0; i++) {
                        navigateUp();
                    }
                    break;
            }
        });

        // Load lyrics on page load
        loadLyrics();
    </script>
</body>
</html>

